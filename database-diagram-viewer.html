<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey System - Database Schema</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1em;
        }
        
        .diagram-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .mermaid {
            text-align: center;
            background: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            color: #718096;
            font-size: 1em;
        }
        
        .legend {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .legend h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .legend-item {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .legend-item h4 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .legend-item p {
            color: #718096;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        .download-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-top: 30px;
            text-align: center;
        }
        
        .download-section h2 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .download-section p {
            color: #718096;
            margin-bottom: 20px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.2s;
            border: none;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .download-section,
            .stats-grid {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Survey System Database Schema</h1>
            <p>Complete Entity Relationship Diagram for Property Survey Management System</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>10</h3>
                <p>Total Tables</p>
            </div>
            <div class="stat-card">
                <h3>9</h3>
                <p>Relationships</p>
            </div>
            <div class="stat-card">
                <h3>3</h3>
                <p>User Roles</p>
            </div>
            <div class="stat-card">
                <h3>4</h3>
                <p>Survey Levels</p>
            </div>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
erDiagram
    Users ||--o{ Survey_Jobs : "creates/owns"
    Survey_Jobs ||--o{ Property_Rooms : "has"
    Survey_Jobs ||--o{ Survey_Data : "contains"
    Survey_Jobs ||--o{ Repair_Costs : "includes"
    Survey_Jobs ||--o{ Land_Property_Checks : "requires"
    Survey_Jobs ||--o{ Certificates_Warranties : "needs"
    Survey_Jobs ||--o{ AI_Processing_Logs : "processed_by"
    Survey_Jobs ||--o{ Generated_Reports : "generates"
    Survey_Sections ||--o{ Survey_Data : "categorizes"

    Users {
        bigint id PK
        varchar email UK
        varchar password
        enum role "admin, surveyor, client"
        varchar name
        varchar phone
        timestamp created_at
        timestamp updated_at
    }

    Survey_Jobs {
        bigint id PK
        bigint client_id FK
        text property_address
        enum survey_level "level_2, level_3, level_3_plus, roof_report"
        enum status "pending, confirmed, in_progress, completed"
        enum payment_status "pending, paid, refunded"
        decimal total_cost
        timestamp created_at
        datetime scheduled_date
    }

    Survey_Sections {
        bigint id PK
        varchar name "Roof, External Walls, Electrical"
        enum survey_level "level_2, level_3, level_3_plus, roof_report"
        int order_index
        boolean is_active
    }

    Property_Rooms {
        bigint id PK
        bigint survey_job_id FK
        varchar room_name "Bedroom 1, Kitchen"
        varchar location
        enum orientation "front, rear, centre"
        text photos_observations
        timestamp created_at
    }

    Survey_Data {
        bigint id PK
        bigint survey_job_id FK
        bigint section_id FK
        varchar field_name "Roof1, ExternalWalls1"
        text field_value
        enum condition_rating "green, orange, red"
        json photos "array of image URLs"
        timestamp created_at
        timestamp updated_at
    }

    Repair_Costs {
        bigint id PK
        bigint survey_job_id FK
        enum category "essential, provisional, improvement"
        varchar element "Electricity Supply, Roof"
        text description
        varchar due_date "now, 2025, 2030"
        decimal estimated_cost
        timestamp created_at
    }

    Land_Property_Checks {
        bigint id PK
        bigint survey_job_id FK
        varchar check_item "Restrictive Covenants"
        enum status "pending, completed, not_applicable"
        text notes
        timestamp created_at
    }

    Certificates_Warranties {
        bigint id PK
        bigint survey_job_id FK
        varchar item "Electrical Certificate"
        enum status "required, obtained, not_required"
        text notes
        date expiry_date
        timestamp created_at
    }

    AI_Processing_Logs {
        bigint id PK
        bigint survey_job_id FK
        text input_data
        text ai_prompt_used
        text ai_response
        json condition_ratings_generated
        int processing_time
        timestamp created_at
    }

    Generated_Reports {
        bigint id PK
        bigint survey_job_id FK
        longtext report_content "HTML/JSON structured data"
        varchar pdf_url
        enum status "draft, final, delivered"
        timestamp created_at
        timestamp delivered_at
    }
            </div>
        </div>
        
        <div class="legend">
            <h2>üìã Table Descriptions</h2>
            <div class="legend-grid">
                <div class="legend-item">
                    <h4>üë§ Users</h4>
                    <p>Core authentication table. Manages admin, surveyor, and client accounts with role-based access control.</p>
                </div>
                
                <div class="legend-item">
                    <h4>üìã Survey_Jobs</h4>
                    <p>Central workflow table. Tracks survey requests from creation through completion, including payment status.</p>
                </div>
                
                <div class="legend-item">
                    <h4>üìë Survey_Sections</h4>
                    <p>Template configuration. Defines standardized sections (Roof, Walls, Electrical) for each survey level.</p>
                </div>
                
                <div class="legend-item">
                    <h4>üè† Property_Rooms</h4>
                    <p>Accommodation layout. Documents room configuration, orientation, and location-specific observations.</p>
                </div>
                
                <div class="legend-item">
                    <h4>üìä Survey_Data</h4>
                    <p>Main observations storage. Contains field-level data with AI-generated condition ratings (green/orange/red).</p>
                </div>
                
                <div class="legend-item">
                    <h4>üí∞ Repair_Costs</h4>
                    <p>Cost summaries. Extracted repair costs categorized as essential, provisional, or improvement with due dates.</p>
                </div>
                
                <div class="legend-item">
                    <h4>üîç Land_Property_Checks</h4>
                    <p>Legal requirements. Tracks necessary checks like flood risk, mining reports, and restrictive covenants.</p>
                </div>
                
                <div class="legend-item">
                    <h4>üìú Certificates_Warranties</h4>
                    <p>Documentation tracking. Manages electrical certificates, gas safety, roof guarantees, and warranties.</p>
                </div>
                
                <div class="legend-item">
                    <h4>ü§ñ AI_Processing_Logs</h4>
                    <p>Audit trail. Records AI prompts, responses, and condition ratings for quality control and debugging.</p>
                </div>
                
                <div class="legend-item">
                    <h4>üìÑ Generated_Reports</h4>
                    <p>Final output. Stores HTML/JSON report content and PDF links with delivery status tracking.</p>
                </div>
            </div>
        </div>
        
        <div class="download-section">
            <h2>üíæ Export Options</h2>
            <p>To save this diagram as an image:</p>
            <button class="btn" onclick="window.print()">üñ®Ô∏è Print to PDF</button>
            <button class="btn" onclick="downloadSVG()">‚¨áÔ∏è Download SVG</button>
            <button class="btn" onclick="copyToClipboard()">üìã Copy Mermaid Code</button>
        </div>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#2d3748',
                primaryBorderColor: '#5a67d8',
                lineColor: '#a0aec0',
                secondaryColor: '#f7fafc',
                tertiaryColor: '#edf2f7',
                fontSize: '14px'
            }
        });
        
        function downloadSVG() {
            const svg = document.querySelector('.mermaid svg');
            if (svg) {
                const serializer = new XMLSerializer();
                const svgString = serializer.serializeToString(svg);
                const blob = new Blob([svgString], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'survey-system-database-diagram.svg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }
        
        function copyToClipboard() {
            const mermaidCode = document.querySelector('.mermaid').textContent;
            navigator.clipboard.writeText(mermaidCode).then(() => {
                alert('‚úÖ Mermaid code copied to clipboard!');
            });
        }
    </script>
</body>
</html>



