<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey System - Data Flow Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1em;
        }
        
        .diagram-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .mermaid {
            text-align: center;
            background: white;
        }
        
        .section-title {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin: 30px 0 20px 0;
            text-align: center;
        }
        
        .section-title h2 {
            color: #2d3748;
            font-size: 2em;
        }
        
        .download-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.2s;
            border: none;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(240, 147, 251, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ Survey System - Data Flow</h1>
            <p>Complete Process Flow from Survey Request to Report Delivery</p>
        </div>
        
        <div class="section-title">
            <h2>ğŸ“Š Main Workflow</h2>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
flowchart TD
    Start([Client Requests Survey]) --> CreateJob[Create Survey_Job]
    CreateJob --> JobPending{Status: Pending}
    JobPending --> AdminReview[Admin Reviews Request]
    AdminReview --> Confirm[Status: Confirmed]
    Confirm --> AssignSurveyor[Assign to Surveyor]
    AssignSurveyor --> Schedule[Set scheduled_date]
    Schedule --> InProgress[Status: In Progress]
    
    InProgress --> RoomConfig[Fill Property_Rooms]
    InProgress --> SurveyData[Fill Survey_Data]
    
    RoomConfig --> RoomDetails[Room Name, Location<br/>Orientation, Photos]
    SurveyData --> Sections[Use Survey_Sections<br/>Templates]
    Sections --> Fields[Field-by-field<br/>Observations]
    
    Fields --> AIProcess[AI Processing]
    AIProcess --> AILog[Store in<br/>AI_Processing_Logs]
    AIProcess --> Ratings[Generate Condition<br/>Ratings: Green/Orange/Red]
    
    Ratings --> ExtractCosts[Extract Repair_Costs]
    ExtractCosts --> CostCategories[Essential<br/>Provisional<br/>Improvement]
    
    InProgress --> Checks[Complete Land_Property_Checks]
    Checks --> CheckItems[Flood Risk<br/>Mining Reports<br/>Covenants]
    
    InProgress --> Certs[Verify Certificates_Warranties]
    Certs --> CertItems[Electrical Certificate<br/>Gas Safety<br/>Roof Guarantees]
    
    CostCategories --> Generate[Generate Report]
    CheckItems --> Generate
    CertItems --> Generate
    AILog --> Generate
    
    Generate --> Draft[Generated_Reports<br/>Status: Draft]
    Draft --> Review{Review OK?}
    Review -->|No| Revise[Revise Report]
    Revise --> Draft
    Review -->|Yes| Final[Status: Final]
    Final --> CreatePDF[Generate PDF]
    CreatePDF --> Deliver[Status: Delivered]
    Deliver --> Complete[Survey_Job<br/>Status: Completed]
    Complete --> Payment{Payment Status}
    Payment --> Paid[Paid âœ“]
    Payment --> Pending[Pending]
    Pending --> Reminder[Send Reminder]
    
    style Start fill:#667eea,stroke:#5a67d8,color:#fff
    style Complete fill:#48bb78,stroke:#38a169,color:#fff
    style Paid fill:#48bb78,stroke:#38a169,color:#fff
    style AIProcess fill:#9f7aea,stroke:#805ad5,color:#fff
    style Generate fill:#ed8936,stroke:#dd6b20,color:#fff
    style Deliver fill:#4299e1,stroke:#3182ce,color:#fff
            </div>
        </div>
        
        <div class="section-title">
            <h2>ğŸ—„ï¸ Database Relationships</h2>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph Core["ğŸ” Core System"]
        Users[ğŸ‘¤ Users<br/>---<br/>Admin, Surveyor, Client]
    end
    
    subgraph Jobs["ğŸ“‹ Survey Management"]
        SurveyJobs[ğŸ“‹ Survey_Jobs<br/>---<br/>Status, Payment, Schedule]
        SurveySections[ğŸ“‘ Survey_Sections<br/>---<br/>Templates by Level]
    end
    
    subgraph Data["ğŸ“Š Survey Data Collection"]
        PropertyRooms[ğŸ  Property_Rooms<br/>---<br/>Room Layout]
        SurveyData[ğŸ“Š Survey_Data<br/>---<br/>Field Observations]
    end
    
    subgraph Analysis["ğŸ” Analysis & Costs"]
        RepairCosts[ğŸ’° Repair_Costs<br/>---<br/>Essential, Provisional]
        LandChecks[ğŸ” Land_Property_Checks<br/>---<br/>Legal Requirements]
        Certificates[ğŸ“œ Certificates_Warranties<br/>---<br/>Documentation]
    end
    
    subgraph AI["ğŸ¤– AI Processing"]
        AILogs[ğŸ¤– AI_Processing_Logs<br/>---<br/>Prompts & Responses]
    end
    
    subgraph Output["ğŸ“„ Final Output"]
        Reports[ğŸ“„ Generated_Reports<br/>---<br/>HTML, PDF]
    end
    
    Users -->|creates| SurveyJobs
    SurveyJobs -->|has| PropertyRooms
    SurveyJobs -->|contains| SurveyData
    SurveySections -->|categorizes| SurveyData
    SurveyJobs -->|includes| RepairCosts
    SurveyJobs -->|requires| LandChecks
    SurveyJobs -->|needs| Certificates
    SurveyJobs -->|processed by| AILogs
    SurveyJobs -->|generates| Reports
    
    style Users fill:#667eea,stroke:#5a67d8,color:#fff
    style SurveyJobs fill:#48bb78,stroke:#38a169,color:#fff
    style AILogs fill:#9f7aea,stroke:#805ad5,color:#fff
    style Reports fill:#ed8936,stroke:#dd6b20,color:#fff
            </div>
        </div>
        
        <div class="section-title">
            <h2>ğŸ”„ Survey Lifecycle States</h2>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
stateDiagram-v2
    [*] --> Pending: Client Creates Request
    Pending --> Confirmed: Admin Approves
    Confirmed --> InProgress: Surveyor Starts Work
    InProgress --> InProgress: Data Collection
    InProgress --> Completed: Report Delivered
    Completed --> [*]
    
    Pending --> Cancelled: Client Cancels
    Confirmed --> Cancelled: Admin Cancels
    Cancelled --> [*]
    
    note right of Pending
        Initial state
        Awaiting admin review
    end note
    
    note right of Confirmed
        Survey scheduled
        Surveyor assigned
    end note
    
    note right of InProgress
        Active data collection
        AI processing
        Report generation
    end note
    
    note right of Completed
        Report delivered
        Payment processed
    end note
            </div>
        </div>
        
        <div class="section-title">
            <h2>ğŸ’³ Payment Flow</h2>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant C as Client
    participant S as System
    participant A as Admin
    participant Sur as Surveyor
    participant AI as AI Service
    
    C->>S: Request Survey (Level 3)
    S->>S: Create Survey_Job (Status: Pending)
    S->>S: Calculate total_cost
    S-->>C: Quote Provided
    
    A->>S: Review Request
    A->>S: Confirm Survey
    S->>S: Update Status: Confirmed
    S->>Sur: Assign Job
    S-->>C: Confirmation Email
    
    C->>S: Make Payment
    S->>S: Update payment_status: Paid
    
    Sur->>S: Start Survey
    S->>S: Update Status: In Progress
    Sur->>S: Fill Property_Rooms
    Sur->>S: Fill Survey_Data
    
    S->>AI: Process Survey Data
    AI->>AI: Generate Condition Ratings
    AI-->>S: Return Ratings + Costs
    S->>S: Store AI_Processing_Logs
    S->>S: Create Repair_Costs
    S->>S: Complete Land_Property_Checks
    S->>S: Verify Certificates_Warranties
    
    S->>S: Generate Report (Draft)
    A->>S: Review Report
    A->>S: Approve Report (Final)
    S->>S: Generate PDF
    S->>S: Update Status: Completed
    S-->>C: Email Report + PDF
    S->>S: Create Generated_Reports (Delivered)
            </div>
        </div>
        
        <div class="section-title">
            <h2>ğŸ¯ Condition Rating System</h2>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
pie title AI Condition Rating Distribution Example
    "ğŸŸ¢ Green (Good)" : 60
    "ğŸŸ  Orange (Attention)" : 30
    "ğŸ”´ Red (Critical)" : 10
            </div>
        </div>
        
        <div class="section-title">
            <h2>ğŸ“Š Data Volume Estimation</h2>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
graph LR
    subgraph "Per Survey Job"
        A[1 Survey_Job] --> B[5-8 Property_Rooms]
        A --> C[30-50 Survey_Data]
        A --> D[10-20 Repair_Costs]
        A --> E[5-10 Land_Property_Checks]
        A --> F[3-7 Certificates_Warranties]
        A --> G[1-3 AI_Processing_Logs]
        A --> H[1-2 Generated_Reports]
    end
    
    style A fill:#667eea,stroke:#5a67d8,color:#fff
    style B fill:#48bb78,stroke:#38a169,color:#fff
    style C fill:#48bb78,stroke:#38a169,color:#fff
    style D fill:#ed8936,stroke:#dd6b20,color:#fff
    style E fill:#ed8936,stroke:#dd6b20,color:#fff
    style F fill:#ed8936,stroke:#dd6b20,color:#fff
    style G fill:#9f7aea,stroke:#805ad5,color:#fff
    style H fill:#4299e1,stroke:#3182ce,color:#fff
            </div>
        </div>
        
        <div class="download-section">
            <h2>ğŸ’¾ Export Options</h2>
            <p>Save these diagrams as images or use the code:</p>
            <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Print to PDF</button>
            <button class="btn" onclick="copyAllDiagrams()">ğŸ“‹ Copy All Mermaid Code</button>
        </div>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#f093fb',
                primaryTextColor: '#2d3748',
                primaryBorderColor: '#f5576c',
                lineColor: '#a0aec0',
                secondaryColor: '#f7fafc',
                tertiaryColor: '#edf2f7',
                fontSize: '14px'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });
        
        function copyAllDiagrams() {
            const diagrams = Array.from(document.querySelectorAll('.mermaid'))
                .map(el => el.textContent)
                .join('\n\n---\n\n');
            
            navigator.clipboard.writeText(diagrams).then(() => {
                alert('âœ… All diagram codes copied to clipboard!');
            });
        }
    </script>
</body>
</html>



